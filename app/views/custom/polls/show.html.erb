<% provide :title do %><%= @poll.name %><% end %>

<div class="polls-show">
  <%= render "poll_header" %>

  <div class="row margin">
    <div class="small-12 medium-9 column">
      <%= safe_html_with_links simple_format(@poll.summary) %>
      <% if @poll.geozones.any? %>
        <ul class="no-bullet margin-top tags">
          <% @poll.geozones.each do |g| %>
            <li class="inline-block"><span><%= g.name %></span></li>
          <% end %>
        </ul>
      <% end %>

    </div>
    <aside class="small-12 medium-3 column">
      <%= render partial: 'shared/social_share', locals: {
        share_title: t("shared.share"),
        title: @poll.name,
        url: poll_url(@poll),
        description: @poll.name,
        image_url:  @poll.image ? request.protocol + request.host_with_port + @poll.image_url(:large) : nil
      } %>
    </aside>
  </div>

  <%= render "poll_subnav" %>

  <div class="row margin">
    <div class="small-12 medium-9 column">
      <%= render "callout" %>

      <% if @poll.voted_in_booth?(current_user) %>
        <div class="callout warning">
          <%= t("polls.show.already_voted_in_booth") %>
        </div>
      <% else %>

        <% if current_user && @poll.voted_in_web?(current_user) && !@poll.expired? %>
          <div class="callout warning">
            <%= t("polls.show.already_voted_in_web") %>
          </div>
        <% end %>
      <% end %>


      <% if !!current_user && !current_user.unverified? && current_user.account_complete? %>
        <%= form_for answer_question_url, remote: true do |f| %>
          <% @questions.each do |question| %>
            <%= render 'polls/questions/question', fq: f, question: question , token: @token %>
          <% end %>
    
          <% if poll_voter_token(@poll, current_user).empty? %>
            <div class="callout token-message js-token-message" style="display: none">
              <%= t('poll_questions.show.voted_token') %>
            </div>
          <% end %>        
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="expanded">
    <div class="row margin margin-footer poll-more-info">
      <div class="small-12 medium-9 column margin-top">
        <h3><%= t("polls.show.more_info_title") %></h3>
        <%= safe_html_with_links simple_format(@poll.description) %>
      </div>

      <% if false %>
        <aside class="small-12 medium-3 column margin-top">
          <div class="sidebar-divider"></div>
          <h2><%= t("polls.show.documents") %></h2>
        </aside>
      <% end %>
    </div>
  </div>

 <% if @poll_questions_answers.present? %>
  <div class="row poll-more-info-answers">
    <div class="padding clearfix">

      <% @poll_questions_answers.each do |answer| %>
        <div class="small-12 medium-6 column margin-bottom end answer <%= cycle('first', '') %>" id="answer_<%= answer.id %>">

          <% if answer.description.present? %>
            <h3><%= answer.title %></h3>
          <% end %>

          <% if answer.images.any? %>
            <%= render "gallery", answer: answer %>
          <% end %>

          <% if answer.description.present? %>
            <div class="margin-top">
              <div id="answer_description_<%= answer.id %>" class="answer-description" data-toggler="short">
                <%= safe_html_with_links simple_format(answer.description) %>
              </div>
            </div>
          <% end %>

          <% if answer.documents.present? %>
            <div class="document-link">
                <h4><%= t("polls.show.documents") %></h4>

              <% answer.documents.each do |document| %>
              <span class="icon-document"></span>&nbsp;
                  <%= link_to document.title,
                              document.attachment.url,
                              target: "_blank",
                              rel: "nofollow" %><br>
              <% end %>
            </div>
          <% end %>

          <% if answer.videos.present? %>
            <div class="video-link"> 
                <h4><%= t("polls.show.videos") %></h4>

              <% answer.videos.each do |video| %>
              <span class="icon-video"></span>&nbsp;
                  <%= link_to video.title,
                              video.url,
                              target: "_blank",
                              rel: "nofollow" %><br>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

  </div>
  <% end %>

  <div class="tabs-content" data-tabs-content="polls_tabs" role="tablist">
    <%= render "filter_subnav" %>

    <div class="tabs-panel is-active" id="tab-comments">
      <%= render "comments" %>
    </div>
  </div>
</div>
